!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="fb59ef70-aeaf-4964-9a1c-7ce26b333ddf",e._sentryDebugIdIdentifier="sentry-dbid-fb59ef70-aeaf-4964-9a1c-7ce26b333ddf")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7688],{79996:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/tables",function(){return t(20664)}])},66764:function(e,n,t){"use strict";t.d(n,{Z:function(){return o}});let o=(0,t(96813).Z)("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]])},4413:function(e,n,t){"use strict";t.d(n,{Z:function(){return o}});let o=(0,t(96813).Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},61389:function(e,n,t){"use strict";t.d(n,{Z:function(){return I}});var o=t(97458),l=t(72292),i=t(94497),a=t.n(i),r=t(34549),s=t(43728),c=t(59185),d=t(98777),u=t(36457),m=t(64618),f=t(6153),g=t(66822),h=t(1281),v=t(13411),y=t(14677),b=t(82370);async function p(e){let{projectRef:n,connectionString:t,table:o,filters:l,roleImpersonationState:i}=e,a=(0,h.Jh)(function(e){var n;let{table:t,filters:o}=e,l=new f.Query().from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).delete();return o.filter(e=>e.value&&""!==e.value).forEach(e=>{let n=(0,b.q)(t,e);l=l.filter(e.column,e.operator,n)}),l.toSql()}({table:o,filters:l}),i),{result:r}=await (0,g.R)({projectRef:n,connectionString:t,sql:a,isRoleImpersonationEnabled:(0,v.Gm)(null==i?void 0:i.role)});return r}let w=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=(0,u.NL)();return(0,m.D)(e=>p(e),{async onSuccess(n,t,l){let{projectRef:i,table:a}=t;await o.invalidateQueries(y.s.tableRowsAndCount(i,a.id)),await (null==e?void 0:e(n,t,l))},async onError(e,t,o){void 0===n?r.Am.error("Failed to delete all table rows: ".concat(e.message)):n(e,t,o)},...t})};var x=t(92297),D=t(44658);async function j(e){let{projectRef:n,connectionString:t,table:o,rows:l,roleImpersonationState:i}=e,a=(0,h.Jh)(function(e){var n;let{table:t,rows:o}=e,{primaryKeys:l,error:i}=(0,b.h)({table:t});if(i)throw i;let a=new f.Query().from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).delete();return null==l||l.forEach(e=>{let n=o.map(n=>n[e]);a=a.filter(e,"in",n)}),a.toSql()}({table:o,rows:l}),i),{result:r}=await (0,g.R)({projectRef:n,connectionString:t,sql:a,isRoleImpersonationEnabled:(0,v.Gm)(null==i?void 0:i.role)});return r}let C=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,u.NL)();return(0,m.D)(e=>j(e),{async onSuccess(n,t,o){let{projectRef:i,table:a}=t;await l.invalidateQueries(y.s.tableRowsAndCount(i,a.id)),await (null==e?void 0:e(n,t,o))},async onError(e,t,l){if(void 0===n){let{table:n,rows:l}=t,i=e.message.includes("Please add a primary key column"),a=e.message.includes("violates foreign key constraint"),s=l.length>1;if(a){let t=n.name,l=e.message.split("on table ")[2].replaceAll('"',""),i=e.message.split("foreign key constraint")[1].split("on table")[0].replaceAll('"',""),a=s?"Unable to delete rows as one of them is currently referenced by a foreign key constraint from the table `".concat(l,"`."):"Unable to delete row as it is currently referenced by a foreign key constraint from the table `".concat(l,"`."),c="Set an on delete behavior on the foreign key relation `".concat(i,"` in the `").concat(l,"` table to automatically respond when row(s) are being deleted in the `").concat(t,"` table.");(0,r.Am)(a,{description:(0,o.jsx)(x.U,{content:c,className:"[&>p]:m-0"}),action:(0,o.jsx)("div",{className:"w-full flex gap-x-2 !mx-0 mt-3",children:(0,o.jsx)(D.G,{href:"https://supabase.com/docs/guides/database/postgres/cascade-deletes"})})})}else i?(0,r.Am)("Unable to delete row(s) as table has no primary keys",{description:(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-sm text-foreground-light",children:"Add a primary key column to your table first to serve as a unique identifier for each row before updating or deleting the row."}),(0,o.jsx)("div",{className:"mt-3",children:(0,o.jsx)(D.G,{href:"https://supabase.com/docs/guides/database/tables#primary-keys"})})]})}):r.Am.error("Failed to delete table row: ".concat(e.message))}else n(e,t,l)},...t})};async function S(e){let{projectRef:n,connectionString:t,table:o}=e,l=function(e){var n;let{table:t}=e;return new f.Query().from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).truncate().toSql()}({table:o}),{result:i}=await (0,g.R)({projectRef:n,connectionString:t,sql:l});return i}let k=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=(0,u.NL)();return(0,m.D)(e=>S(e),{async onSuccess(n,t,l){let{projectRef:i,table:a}=t;await o.invalidateQueries(y.s.tableRowsAndCount(i,a.id)),await (null==e?void 0:e(n,t,l))},async onError(e,t,o){void 0===n?r.Am.error("Failed to truncate table row: ".concat(e.message)):n(e,t,o)},...t})};var A=t(76950),N=t(67106),_=t(9258),E=t(54099),T=t(61543),R=t(38832),Z=t(19570),L=t(97380),q=t(10503),F=t(28827),I=e=>{var n,t,i,u,m,f,g,h,y;let{selectedTable:b,onAfterDeleteTable:p=E.ZT}=e,{project:x}=(0,c.d2)(),D=(0,T._2)(),{selectedSchema:j}=(0,_.B)(),{filters:S,setParams:I}=(0,F.T)(),z=(0,s.Yb)(S),M=(0,N.AF)({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString}),Q=e=>{let{ref:n,tableName:t,schema:o,columnName:l}=e;I(e=>{var i,a;let r=null!==(i=null==e?void 0:e.filter)&&void 0!==i?i:[],c=null!==(a=null==e?void 0:e.sort)&&void 0!==a?a:[],d={filter:r.filter(e=>{let[n]=e.split(":");if(n!==l)return e}),sort:c.filter(e=>{let[n]=e.split(":");if(n!==l)return e})};return(0,s.OM)({projectRef:n,tableName:t,schema:o,filters:d.filter,sorts:d.sort}),{...e,...d}})},{mutate:X}=(0,d.v)({onSuccess:()=>{var e;if((null===(e=D.confirmationDialog)||void 0===e?void 0:e.type)!=="column")return;let n=D.confirmationDialog.column;(null==x?void 0:x.ref)&&(null==b?void 0:b.name)&&(Q({ref:null==x?void 0:x.ref,tableName:null==b?void 0:b.name,schema:n.schema,columnName:n.name}),r.Am.success('Successfully deleted column "'.concat(n.name,'"')))},onError:e=>{var n;if((null===(n=D.confirmationDialog)||void 0===n?void 0:n.type)!=="column")return;let t=D.confirmationDialog.column;r.Am.error("Failed to delete ".concat(t.name,": ").concat(e.message))},onSettled:()=>{D.closeConfirmationDialog()}}),{mutate:G}=(0,A.H)({onSuccess:async()=>{p(await M(j)),r.Am.success('Successfully deleted table "'.concat(null==b?void 0:b.name,'"'))},onError:e=>{r.Am.error("Failed to delete ".concat(null==b?void 0:b.name,": ").concat(e.message))},onSettled:()=>{D.closeConfirmationDialog()}}),{mutate:P}=C({onSuccess:()=>{var e,n,t;(null===(e=D.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(n=(t=D.confirmationDialog).callback)||void 0===n||n.call(t)),r.Am.success("Successfully deleted selected row(s)")},onSettled:()=>{D.closeConfirmationDialog()}}),{mutate:W}=w({onSuccess:()=>{var e,n,t;(null===(e=D.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(n=(t=D.confirmationDialog).callback)||void 0===n||n.call(t)),r.Am.success("Successfully deleted selected rows")},onError:e=>{r.Am.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{D.closeConfirmationDialog()}}),{mutate:O}=k({onSuccess:()=>{var e,n,t;(null===(e=D.confirmationDialog)||void 0===e?void 0:e.type)==="row"&&(null===(n=(t=D.confirmationDialog).callback)||void 0===n||n.call(t)),r.Am.success("Successfully deleted all rows from table")},onError:e=>{r.Am.error("Failed to delete rows: ".concat(e.message))},onSettled:()=>{D.closeConfirmationDialog()}}),U=(null===(n=D.confirmationDialog)||void 0===n?void 0:n.type)==="row"&&D.confirmationDialog.allRowsSelected,H=(null===(t=D.confirmationDialog)||void 0===t?void 0:t.type)==="row"?D.confirmationDialog.allRowsSelected?null!==(y=D.confirmationDialog.numRows)&&void 0!==y?y:0:D.confirmationDialog.rows.length:0,J=((null===(i=D.confirmationDialog)||void 0===i?void 0:i.type)==="column"||(null===(u=D.confirmationDialog)||void 0===u?void 0:u.type)==="table")&&D.confirmationDialog.isDeleteWithCascade,V=async()=>{var e;if((null===(e=D.confirmationDialog)||void 0===e?void 0:e.type)!=="column"||void 0===x)return;let n=D.confirmationDialog.column;void 0!==n&&X({id:n.id,cascade:J,projectRef:x.ref,connectionString:null==x?void 0:x.connectionString,table:b})},B=async()=>{var e;(null===(e=D.confirmationDialog)||void 0===e?void 0:e.type)==="table"&&void 0!==b&&G({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString,schema:b.schema,id:b.id,cascade:J})},Y=(0,v.MG)(),K=async()=>{var e;if(!x)return console.error("Project ref is required");if(!b)return console.error("Selected table required");if((null===(e=D.confirmationDialog)||void 0===e?void 0:e.type)!=="row")return;let n=D.confirmationDialog.rows;if(D.confirmationDialog.allRowsSelected){if(0===z.length){if(void 0!==Y().role)return D.closeConfirmationDialog(),r.Am.error("Table truncation is not supported when impersonating a role");O({projectRef:x.ref,connectionString:x.connectionString,table:b})}else W({projectRef:x.ref,connectionString:x.connectionString,table:b,filters:z,roleImpersonationState:Y()})}else P({projectRef:x.ref,connectionString:x.connectionString,table:b,rows:n,roleImpersonationState:Y()})};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(q.Z,{variant:"destructive",size:"small",visible:(null===(m=D.confirmationDialog)||void 0===m?void 0:m.type)==="column",title:'Confirm deletion of column "'.concat((null===(f=D.confirmationDialog)||void 0===f?void 0:f.type)==="column"&&D.confirmationDialog.column.name,'"'),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{D.closeConfirmationDialog()},onConfirm:V,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected column? This action cannot be undone."}),(0,o.jsx)(R.Z,{label:"Drop column with cascade?",description:"Deletes the column and its dependent objects",checked:J,onChange:()=>D.toggleConfirmationIsWithCascade(),"data-sentry-element":"Checkbox","data-sentry-source-file":"DeleteConfirmationDialogs.tsx"}),J&&(0,o.jsxs)(Z.bZ,{variant:"warning",title:"Warning: Dropping with cascade may result in unintended consequences",children:[(0,o.jsx)(Z.Cd,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,o.jsx)(Z.X,{children:(0,o.jsx)(L.z,{asChild:!0,size:"tiny",type:"default",icon:(0,o.jsx)(l.Z,{}),children:(0,o.jsx)(a(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,o.jsx)(q.Z,{variant:"destructive",size:"small",visible:(null===(g=D.confirmationDialog)||void 0===g?void 0:g.type)==="table",title:(0,o.jsx)("span",{className:"break-words",children:'Confirm deletion of table "'.concat(null==b?void 0:b.name,'"')}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>{D.closeConfirmationDialog()},onConfirm:B,"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you want to delete the selected table? This action cannot be undone."}),(0,o.jsx)(R.Z,{label:"Drop table with cascade?",description:"Deletes the table and its dependent objects",checked:J,onChange:()=>D.toggleConfirmationIsWithCascade(!J),"data-sentry-element":"Checkbox","data-sentry-source-file":"DeleteConfirmationDialogs.tsx"}),J&&(0,o.jsxs)(Z.bZ,{variant:"warning",children:[(0,o.jsx)(Z.Cd,{children:"Warning: Dropping with cascade may result in unintended consequences"}),(0,o.jsx)(Z.X,{children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,o.jsx)(Z.X,{className:"mt-4",children:(0,o.jsx)(L.z,{asChild:!0,size:"tiny",type:"default",icon:(0,o.jsx)(l.Z,{}),children:(0,o.jsx)(a(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",target:"_blank",rel:"noreferrer",children:"About dependency tracking"})})})]})]})}),(0,o.jsx)(q.Z,{variant:"destructive",size:"small",visible:(null===(h=D.confirmationDialog)||void 0===h?void 0:h.type)==="row",title:(0,o.jsxs)("p",{className:"break-words",children:[(0,o.jsx)("span",{children:"Confirm to delete the selected row"}),(0,o.jsx)("span",{children:H>1&&"s"})]}),confirmLabel:"Delete",confirmLabelLoading:"Deleting",onCancel:()=>D.closeConfirmationDialog(),onConfirm:()=>K(),"data-sentry-element":"ConfirmationModal","data-sentry-source-file":"DeleteConfirmationDialogs.tsx",children:(0,o.jsx)("div",{className:"space-y-4",children:(0,o.jsxs)("p",{className:"text-sm text-foreground-light",children:[(0,o.jsx)("span",{children:"Are you sure you want to delete "}),(0,o.jsxs)("span",{children:[U?"all":"the selected"," "]}),(0,o.jsx)("span",{children:H>1&&"".concat(H," ")}),(0,o.jsx)("span",{children:"row"}),(0,o.jsx)("span",{children:H>1&&"s"}),(0,o.jsx)("span",{children:"? This action cannot be undone."})]})})})]})}},20664:function(e,n,t){"use strict";t.r(n);var o=t(97458),l=t(52983),i=t(9981),a=t(88135),r=t(61389),s=t(30530),c=t(30578),d=t(43391),u=t(32073),m=t(61543);let f=()=>{let e=(0,m._2)(),[n,t]=(0,l.useState)();return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(d._S,{"data-sentry-element":"ScaffoldContainer","data-sentry-source-file":"index.tsx",children:(0,o.jsx)(d.jX,{"data-sentry-element":"ScaffoldSection","data-sentry-source-file":"index.tsx",children:(0,o.jsxs)("div",{className:"col-span-12",children:[(0,o.jsx)(u.p,{title:"Database Tables","data-sentry-element":"FormHeader","data-sentry-source-file":"index.tsx"}),(0,o.jsx)(i.bw,{onAddTable:e.onAddTable,onEditTable:n=>{t(n),e.onEditTable()},onDeleteTable:n=>{t(n),e.onDeleteTable()},onDuplicateTable:n=>{t(n),e.onDuplicateTable()},"data-sentry-element":"TableList","data-sentry-source-file":"index.tsx"})]})})}),(0,o.jsx)(r.Z,{selectedTable:n,"data-sentry-element":"DeleteConfirmationDialogs","data-sentry-source-file":"index.tsx"}),(0,o.jsx)(a.l5,{includeColumns:!0,selectedTable:n,"data-sentry-element":"SidePanelEditor","data-sentry-source-file":"index.tsx"})]})};f.getLayout=e=>(0,o.jsx)(c.Z,{children:(0,o.jsx)(s.Z,{title:"Database",children:e})}),n.default=f}},function(e){e.O(0,[6665,3659,7186,3856,6664,588,7037,4605,950,292,2433,7639,3662,622,5582,2585,3356,2269,2019,4637,3545,1604,5518,7814,5538,9710,5686,6124,1547,578,28,4886,3430,5377,5622,7712,7824,5315,2634,5349,8135,9774,2888,179],function(){return e(e.s=79996)}),_N_E=e.O()}]);